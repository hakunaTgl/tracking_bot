<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6200ea">
    <title>Smart Bot Hub</title>
    <link rel="manifest" href="manifest.json">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f0f0f0; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; }
        #login, #hub { display: none; }
        #chatArea, #logs { margin-top: 20px; }
        input, button { padding: 10px; margin: 5px; width: calc(100% - 30px); }
        button { background: #6200ea; color: white; border: none; cursor: pointer; }
        .log-entry { border-bottom: 1px solid #ddd; padding: 10px; }
        .error { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <div id="login">
            <h2>Login to Smart Bot Hub</h2>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="password" placeholder="Password">
            <button onclick="signIn()">Login</button>
            <button onclick="signUp()">Sign Up</button>
            <p class="error" id="error"></p>
        </div>
        <div id="hub">
            <h2>Smart Bot Hub</h2>
            <p>Welcome, <span id="userEmail"></span>! <button onclick="signOut()">Logout</button></p>
            <input type="text" id="userInput" placeholder="Ask the AI...">
            <button onclick="sendMessage()">Send</button>
            <div id="chatArea"></div>
            <h3>Your Logs</h3>
            <div id="logs"></div>
            <div id="bossArea" style="display: none;">
                <h3>Boss View: All Logs</h3>
                <div id="allLogs"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

    <script>
        // Firebase configuration (replace with your own config)
        const firebaseConfig = {
            apiKey: "AIzaSyBONwaRl23VeTJISmiQ3X-t3y6FGK7Ngjc",
            authDomain: "tglsmarthub.firebaseapp.com",
            projectId: "tglsmarthub",
            storageBucket: "tglsmarthub.firebasestorage.app",
            messagingSenderId: "361291241205",
            appId: "1:361291241205:web:854f79a0238e6e4795d7bc"
            measurementId: "G-LQ4BP8GG37"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Check user state
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('login').style.display = 'none';
                document.getElementById('hub').style.display = 'block';
                document.getElementById('userEmail').textContent = user.email;
                loadLogs(user.uid);
                checkBossAccess(user.email);
            } else {
                document.getElementById('login').style.display = 'block';
                document.getElementById('hub').style.display = 'none';
            }
        });

        // Sign Up
        function signUp() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            auth.createUserWithEmailAndPassword(email, password)
                .then(() => showMessage('Signed up! Logging you in...'))
                .catch(error => document.getElementById('error').textContent = error.message);
        }

        // Sign In
        function signIn() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(email, password)
                .then(() => showMessage('Logged in!'))
                .catch(error => document.getElementById('error').textContent = error.message);
        }

        // Sign Out
        function signOut() {
            auth.signOut().then(() => showMessage('Logged out!'));
        }

        // Check if user is "boss"
        function checkBossAccess(email) {
            // Replace with your boss email(s)
            const bossEmails = ['boss@example.com'];
            if (bossEmails.includes(email)) {
                document.getElementById('bossArea').style.display = 'block';
                loadAllLogs();
            }
        }

        // Simulated AI with context awareness
        let conversationHistory = [];
        async function getAIResponse(input) {
            // Avoid repetitive answers by tracking history
            if (conversationHistory.includes(input)) {
                return `I see you asked "${input}" before! How about a deeper take: ${simulateAIResponse(input, true)}`;
            }
            conversationHistory.push(input);
            return simulateAIResponse(input, false);
        }

        // Simulate AI response (replace with actual AI API if available)
        function simulateAIResponse(input, isFollowUp) {
            const responses = [
                `Cool question! Here's my take on "${input}": It's like ${input} but with more vibe!`,
                `Yo, "${input}"? That’s wild! Think of it as a puzzle—here’s one piece.`,
                `Hmm, "${input}" makes me think... Imagine it as a spicy taco of ideas!`
            ];
            const followUps = [
                `Diving deeper into "${input}", it’s like a whole new layer of awesome!`,
                `Another angle on "${input}": Picture it with a twist of chaos!`
            ];
            return isFollowUp ? followUps[Math.floor(Math.random() * followUps.length)] : responses[Math.floor(Math.random() * responses.length)];
        }

        // Send message to AI
        async function sendMessage() {
            const input = document.getElementById('userInput').value;
            if (!input) return;
            const user = auth.currentUser;
            if (!user) return;

            // Display user message
            const chatArea = document.getElementById('chatArea');
            chatArea.innerHTML += `<p><b>You:</b> ${input}</p>`;

            // Get and display AI response
            const response = await getAIResponse(input);
            chatArea.innerHTML += `<p><b>AI:</b> ${response}</p>`;
            chatArea.scrollTop = chatArea.scrollHeight;

            // Save log
            await db.collection('logs').add({
                userId: user.uid,
                email: user.email,
                input: input,
                response: response,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });

            // Reload logs
            loadLogs(user.uid);
            document.getElementById('userInput').value = '';
        }

        // Load user logs
        async function loadLogs(userId) {
            const logsDiv = document.getElementById('logs');
            logsDiv.innerHTML = '';
            const querySnapshot = await db.collection('logs')
                .where('userId', '==', userId)
                .orderBy('timestamp', 'desc')
                .get();
            querySnapshot.forEach(doc => {
                const log = doc.data();
                logsDiv.innerHTML += `<div class="log-entry">
                    <p><b>${log.email}</b> (${new Date(log.timestamp?.toDate()).toLocaleString()}):</p>
                    <p><b>You:</b> ${log.input}</p>
                    <p><b>AI:</b> ${log.response}</p>
                </div>`;
            });
        }

        // Load all logs (boss view)
        async function loadAllLogs() {
            const allLogsDiv = document.getElementById('allLogs');
            allLogsDiv.innerHTML = '';
            const querySnapshot = await db.collection('logs')
                .orderBy('timestamp', 'desc')
                .get();
            querySnapshot.forEach(doc => {
                const log = doc.data();
                allLogsDiv.innerHTML += `<div class="log-entry">
                    <p><b>${log.email}</b> (${new Date(log.timestamp?.toDate()).toLocaleString()}):</p>
                    <p><b>User:</b> ${log.input}</p>
                    <p><b>AI:</b> ${log.response}</p>
                </div>`;
            });
        }

        // Show temporary message
        function showMessage(msg) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = msg;
            setTimeout(() => errorDiv.textContent = '', 3000);
        }

        // Service Worker for offline support
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(() => console.log('Service Worker Registered'))
                .catch(err => console.error('Service Worker Error:', err));
        }
    </script>
</body>
</html>
